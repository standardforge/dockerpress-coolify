version: '3.8'
services:
  dockerpress:
    build:
      context: .  # Builds from the current directory using your Dockerfile
      dockerfile: Dockerfile
    #ports:  # Comment out or remove this line and the mapping below
    #  - "80:80"  # Expose OpenLiteSpeed/WordPress (adjust if needed)
    environment:
      - WORDPRESS_DB_HOST  # Required; user sets in UI
      - WORDPRESS_DB_PORT=${WORDPRESS_DB_PORT:-3306}
      - WORDPRESS_DB_NAME
      - WORDPRESS_DB_USER
      - WORDPRESS_DB_PASSWORD
      - ADMIN_USER=DP4CAdmin
      - ADMIN_EMAIL
      - COOLIFY_FDQN
      - COOLIFY_URL
      - WP_LOCALE=en_US
      - WP_DEBUG=false
      - WP_MULTISITE=FALSE  # Pre-populates as FALSE; user can override to TRUE
    labels:
      # These labels tell Coolify/Traefik how to route
      - "coolify.managed=true"
      # This is the critical one - tells Coolify this is the main service
      - "coolify.name=dockerpress"
    networks:
      - coolify
    ports:
      - target: 80
        protocol: tcp
    # Optional: Add healthcheck here if not in Dockerfile
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:80/ -o /dev/null -s"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 120s
    # Volumes for persistence (e.g., WordPress files, if not already handled)
    volumes:
      - wp-data:/var/www/html
    restart: unless-stopped

networks:
  coolify:
    external: true

volumes:
  wp-data:
